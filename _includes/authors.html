{% comment %}
  Usage: {% include authors.html entry=entry %}
{% endcomment %}
{% assign authors = entry.author | split: ' and ' %}
{% assign author_limit = site.pub_show_max_authors %}
{% assign total_shown = author_limit | times: 2 %}
{% assign last_start_index = authors.size | minus: author_limit | plus: 1 %}
{% assign formatted_authors = '' | split: '' %}
{% assign first_authors = '' | split: '' %}
{% assign last_authors = '' | split: '' %}
{% for author in authors %}
  {% assign author_clean = author | strip %}
  {% assign parts = author_clean | split: ', ' %}
  {% if parts.size >= 2 %}
    {% assign formatted_name = parts[1]
      | strip
      | append: ' '
      | append: parts[0]
      | strip
    %}
  {% else %}
    {% assign formatted_name = author_clean %}
  {% endif %}
  {% assign is_team_member = false %}
  {% for team_member in site.data.team %}
    {% assign team_name = team_member.name | strip %}
    {% if team_name == formatted_name %}
      {% assign is_team_member = true %}
      {% break %}
    {% endif %}
  {% endfor %}
  {% if is_team_member %}
    {% assign styled_name = '<span class="team-member">'
      | append: formatted_name
      | append: '</span>'
    %}
  {% else %}
    {% assign styled_name = formatted_name %}
  {% endif %}
  {% assign formatted_authors = formatted_authors | push: styled_name %}
  {% if forloop.index <= author_limit %}
    {% assign first_authors = first_authors | push: styled_name %}
  {% elsif forloop.index >= last_start_index %}
    {% assign last_authors = last_authors | push: styled_name %}
  {% endif %}
{% endfor %}
<div class="bibliography-authors">
  {% if authors.size <= total_shown %}
    {{ formatted_authors | join: ', ' }}
  {% else %}
    {% assign hidden_count = authors.size | minus: total_shown %}
    <span class="authors-short">
      {{ first_authors | join: ', ' }},
      <button
        type="button"
        class="author-toggle btn-link"
        onclick="toggleAuthors(this)"
      >
        ... and {{ hidden_count }} more ...
      </button>
      , {{ last_authors | join: ', ' }}
    </span>
    <span class="authors-full d-none">
      {{ formatted_authors | join: ', ' }}
      <button
        type="button"
        class="author-toggle btn-link"
        onclick="toggleAuthors(this)"
      >
        (show fewer)
      </button>
    </span>
  {% endif %}
</div>

<script>
  function toggleAuthors(btn) {
    const short = btn
      .closest(".bibliography-authors")
      .querySelector(".authors-short")
    const full = btn
      .closest(".bibliography-authors")
      .querySelector(".authors-full")
    short.classList.toggle("d-none")
    full.classList.toggle("d-none")
  }
</script>
