{% comment %} Active nav logic - shared variables {% endcomment %}
{% assign clean_page_url = page.url | remove: '.html' | remove: '/' %}

<nav class="navbar navbar-expand-lg navbar-light fixed-top not-prose">
  <div class="container-md px-3">
    <a class="navbar-brand" href="/">
      <img src="/assets/images/logo-wide.png" alt="SEACrowd Logo" height="28">
    </a>
    <button
      class="navbar-toggler border-0"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon">
        <span class="line line-1"></span>
        <span class="line line-2"></span>
        <span class="line line-3"></span>
      </span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        {% for nav in site.data.navbar %}
          {% assign is_active = false %}
          {% if nav.href %}
            {% assign clean_nav_href = nav.href
              | remove: '.html'
              | remove: '/'
            %}
            {% if page.url == nav.href
              or page.permalink == nav.href
              or clean_page_url == clean_nav_href
              or page.url contains nav.href
            %}
              {% assign is_active = true %}
            {% endif %}
          {% endif %}

          {% if nav.children %}
            {% comment %} Check if any child is active {% endcomment %}
            {% for child in nav.children %}
              {% assign clean_child_href = child.href
                | remove: '.html'
                | remove: '/'
              %}
              {% if page.url == child.href
                or page.permalink == child.href
                or clean_page_url == clean_child_href
                or page.url contains child.href
              %}
                {% assign is_active = true %}
              {% endif %}
            {% endfor %}
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle {% if is_active %}active{% endif %}"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                {{ nav.name }}
              </a>
              <ul class="dropdown-menu">
                {% for child in nav.children %}
                  {% assign clean_child_href = child.href
                    | remove: '.html'
                    | remove: '/'
                  %}
                  <li>
                    <a
                      class="dropdown-item {% if page.url == child.href or page.permalink == child.href or clean_page_url == clean_child_href or page.url contains child.href %}active{% endif %}"
                      href="{{ child.href }}"
                    >
                      {{ child.name }}
                      {% if child.href == '/apprenticeship' -%}
                        {%- include apprenticeship-badge.html -%}
                      {%- endif %}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </li>
          {% elsif nav.cta %}
            <li class="nav-item ms-lg-2">
              <a class="btn btn-primary btn-sm px-3" href="{{ nav.href }}">
                {{- nav.name -}}
              </a>
            </li>
          {% else %}
            <li class="nav-item">
              <a
                class="nav-link {% if is_active %}active{% endif %}"
                href="{{ nav.href }}"
              >
                {{- nav.name -}}
              </a>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>
</nav>

<script
  src="{{ '/assets/js/apprenticeship-dates.js' | relative_url }}"
></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Find the first badge element to get the data
    const badgeElement = document.querySelector(".apprenticeship-badge")

    if (badgeElement) {
      const openDate = badgeElement.getAttribute("data-open-date")
      const closeDate = badgeElement.getAttribute("data-close-date")
      if (openDate && closeDate) {
        // Initialize badge manager for navbar only
        initApprenticeshipBadges(openDate, closeDate)
      }
    }
  })
</script>
